#!/usr/bin/env node

const program = require('commander');
const inquirer = require('inquirer');

const { run } = require('../dist/run');
const { CollectType, TaroPlatform } = require('../dist/lib/const');
const { getCollectComponent } = require('../dist/lib/util');

program
  .option('-n, --name <name>', 'Which component wants to collect', '')
  .option('-t, --type <type>', 'The environment of collecting, taro/rn')
  .option('-p, --platform <platform>', 'weapp/swan/h5/tt/alipay/rn/qq/jd/quickapp')
  .action(async (data) => {
    let { name: componentName, type, platform, env } = data;

    if (!type) {
      const config = await inquirer.prompt([CollectType]);
      type = type || config.type;
    }

    if (!componentName) {
      const CollectComponent = getCollectComponent(type);
      const config = await inquirer.prompt([CollectComponent]);
      componentName = componentName || config.name;
    }

    if (type === 'taro' && !platform) {
      platform = TaroPlatform[platform] || 'h5';
    }
    
    run({ componentName, type, platform, env: 'dev' });
  })
  .parse(process.argv);
